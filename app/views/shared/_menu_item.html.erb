<% classes = ['menu__item'] %>
<% classes.push 'menu__item--with-children' if item['children'].present? %>
<% classes.push "menu__item--#{item['name'].parameterize}" %>
<%= content_tag :li, class: classes.join(' ') do %>
  <% if item['url'].present? %>
    <% link = item['url'] %>
  <% elsif item['page'].present? %>
    <%# TODO: more performant page lookup? Or just make sure this menu partial is cached properly? %>
    <% if Page.find_by_id(item['page']).present? %>
    <%# TODO: catch pages that no longer exist %>
      <% link = show_page_path Page.find_by_id(item['page']) %>
    <% end %>
  <% else %>
    <% link = '#' %>
  <% end %>
  <%= link_to item['name'], link, class: 'menu__item__link' %>
  <% if item['children'].present? %>
    <%= content_tag :ul, class: "menu__sub-menu" do %>
      <%= render partial: 'shared/menu_item', collection: item['children'], as: 'item' %>
    <% end %>
  <% end %>
<% end %>
