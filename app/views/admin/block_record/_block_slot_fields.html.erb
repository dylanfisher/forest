<div class="nested-fields">
  <div class="panel panel-default">
    <div class="panel-heading sortable-handle" data-block-type-header>
      <div class="block-type-header-title">
        <% if f.object.block_kind %>
          <%= content_tag :div, '', class: "nested-fields__panel-display-icon #{f.object.block_kind.name.constantize.display_icon}" %>
          <%= f.object.block_kind.name %>
          <%= f.object.block_id %>
        <% end %>
      </div>

      <div class="btn-group pull-right" role="group">
        <button type="button" class="btn btn-xs btn-default" data-block-collapser title="Collapse block">
          <div class="glyphicon glyphicon-minus"></div>
        </button>
        <%= link_to_remove_association f,
              class: 'btn btn-xs btn-default',
              title: 'Remove block',
              data: {
                confirm: "Are you sure you want to remove this block?" } do %>
          <div class="glyphicon glyphicon-remove"></div>
        <% end %>
      </div>
    </div>

    <div class="panel-body">
      <% klass = f.object.block_kind.name.constantize %>
      <%= f.simple_fields_for :block do |f| %>
        <%= render "blocks/#{klass.model_name.singular}/edit", f: f %>
      <% end %>
    </div>
  </div>

  <%= f.association :block_layout, as: :hidden, input_html: { value: block_layout.id } %>
  <%= f.input :block_record_type, as: :hidden %>
  <%= f.input :position, as: :hidden, input_html: { class: 'block-position' } %>
</div>
